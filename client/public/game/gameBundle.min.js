function singleMain(){window.parent.__singlePlayer__&&(window.onload=function(){function e(){u.load.image("yellowcar","../resources/yellowcar.png"),u.load.image("road","../resources/road.png"),u.load.image("bomb","../resources/bomb.png"),u.load.image("star","../resources/star.png"),u.load.image("hud","../resources/hud.png"),u.load.image("diamond","../resources/diamond.png"),u.load.image("goodDiamond","../resources/goodDiamond.png")}function o(){u.physics.startSystem(Phaser.Physics.ARCADE),road=u.add.tileSprite(0,0,800,600,"road"),player=u.add.sprite(300,10,"yellowcar"),u.physics.arcade.enable(player),player.body.collideWorldBounds=!0,cursors=u.input.keyboard.createCursorKeys(),bombs=u.add.group(),bombs.enableBody=!0,stars=u.add.group(),stars.enableBody=!0,bombEmitter=u.add.emitter(0,0,100),bombEmitter.makeParticles("diamond"),starEmitter=u.add.emitter(0,0,100),starEmitter.makeParticles("goodDiamond"),u.add.tileSprite(0,450,800,100,"hud"),m=u.add.text(20,460,"Score: "+y,{fontSize:"32px",fill:"#000"})
var e=r(600,800)
u.time.events.loop(e,i,this)}function r(e,o){return Math.floor(Math.random()*(o-e))+e}function t(e,o){o.destroy(),d(o,bombEmitter),y+=300}function a(e,o){o.destroy(),d(o,starEmitter),y>301?y-=300:y=1}function n(e,o){var r=e.getBounds(),t=o.getBounds()
return Phaser.Rectangle.intersects(r,t)}function i(){if(c&&!window.parent.__winner__){var e=Math.random()
if(e>.3){var o=bombs.create(r(30,360),400,"bomb")
g.push(o)}else{var t=stars.create(r(30,360),400,"star")
b.push(t)}}}function s(e,o){e.forEach(function(e,r,t){e.body?(e.body.y-=8,n(player,e)?o(player,e):e.body.y<-50&&(t.splice(r,1),e.destroy())):(t.splice(r,1),e.destroy())})}function d(e,o){o.x=e.x,o.y=e.y,o.start(!0,500,null,10)}function l(){y>0&&c?(s(g,t),s(b,a),y-=1,m.text="Distance Remaining: "+y,road.tilePosition.y-=8,cursors.left.isDown&&player.x>20?player.body.x-=20:cursors.right.isDown&&player.x<320&&(player.body.x+=20)):0>=y&&w.emit("requestWinner",{winner:window.parent.__userName__,room:window.parent.__gameRoom__})}var c,m,u=new Phaser.Game(800,512,Phaser.AUTO,"",{preload:e,create:o,update:l}),p="No socket detected. The game must be played through a socket.io server to function properly.",y=5e3,g=[],b=[],w=window.parent.socket
w.emit("requestArrow"),w||(document.getElementById("notify").innerText=p),window.parent.scrollTo(0,window.parent.document.body.scrollHeight),w.on("arrowResponse",function(e){c=!0})})}singleMain()
function multiMain(){window.parent.__multiPlayer__&&(window.onload=function(){function e(){w.stage.disableVisibilityChange=!0,w.load.image("redcar","../resources/redcar.png"),w.load.image("bluecar","../resources/bluecar.png"),w.load.image("road","../resources/road.png"),w.load.image("bomb","../resources/bomb.png"),w.load.image("star","../resources/star.png"),w.load.image("hud","../resources/hud.png"),w.load.image("diamond","../resources/diamond.png"),w.load.image("goodDiamond","../resources/goodDiamond.png")}function o(){w.physics.startSystem(Phaser.Physics.ARCADE),road=w.add.tileSprite(0,0,800,600,"road"),player=w.add.sprite(v.x,v.y,v.car),w.physics.arcade.enable(player),player.body.collideWorldBounds=!0,p=w.add.sprite(D.x,D.y,D.car),w.physics.arcade.enable(p),p.body.collideWorldBounds=!0,cursors=w.input.keyboard.createCursorKeys(),_=w.add.group(),_.enableBody=!0,b=w.add.group(),b.enableBody=!0,bombEmitter=w.add.emitter(0,0,100),bombEmitter.makeParticles("diamond"),starEmitter=w.add.emitter(0,0,100),starEmitter.makeParticles("goodDiamond"),w.add.tileSprite(0,450,800,100,"hud"),y=w.add.text(v.scorex,v.scorey,"Distance Remaining: "+x,{fontSize:"32px",fill:"#000"}),g=w.add.text(D.scorex,D.scorey,"Enemy Distance Remaining: "+h,{fontSize:"32px",fill:"#000"})
var e=n(600,800)
w.time.events.loop(e,i,this)}function n(e,o){return Math.floor(Math.random()*(o-e))+e}function r(e,o,n){o.destroy(),c(o,bombEmitter),n?(x+=300,B.emit("playerScore",{score:x,room:window.parent.__gameRoom__})):h+=300}function t(e,o,n){o.destroy(),c(o,starEmitter),n?(x>301?x-=300:x=1,B.emit("playerScore",{score:x,room:window.parent.__gameRoom__})):h>301?h-=300:h=1}function a(e,o){var n=e.getBounds(),r=o.getBounds()
return Phaser.Rectangle.intersects(n,r)}function i(){if(u&&!window.parent.__winner__&&document.hasFocus()){var e=Math.random()
if(e>.5){var o=_.create(n(v.leftbounds,v.rightbounds),400,"bomb")
E.push(o),s({x:o.x,y:o.y},"bombs")}else{var r=b.create(n(v.leftbounds,v.rightbounds),400,"star")
R.push(r),s({x:r.x,y:r.y},"stars")}}}function s(e,o){B.emit("playerObj",{obj:e,type:o,room:window.parent.__gameRoom__})}function d(e,o,n,r){e.forEach(function(e,t,i){e.body?(e.body.y-=8,a(n,e)?o(player,e,r):e.body.y<-50&&(i.splice(t,1),e.destroy())):(i.splice(t,1),e.destroy())})}function c(e,o){o.x=e.x,o.y=e.y,o.start(!0,500,null,10)}function m(){document.hasFocus()||document.getElementById("notify").innerText||window.parent.__winner__?document.hasFocus()&&document.getElementById("notify").innerText&&(document.getElementById("notify").innerText=""):document.getElementById("notify").innerText="You lost focus. Click on the game to continue.",x>0&&u&&!window.parent.__winner__&&document.hasFocus()?(d(E,r,player,!0),d(E,r,p,!1),d(R,t,player,!0),d(R,t,p,!1),x-=1,y.text="Distance Remaining: "+x,B.emit("playerScore",{score:x,room:window.parent.__gameRoom__}),road.tilePosition.y-=8,cursors.left.isDown&&player.x>v.leftbounds?(player.body.x-=20,B.emit("playerPos",{pos:{x:player.x,y:player.y},room:window.parent.__gameRoom__})):cursors.right.isDown&&player.x<v.rightbounds&&(player.body.x+=20,B.emit("playerPos",{pos:{x:player.x,y:player.y},room:window.parent.__gameRoom__}))):0>=x&&!window.parent.__winner__&&B.emit("requestWinner",{winner:window.parent.__userName__,room:window.parent.__gameRoom__})}var u,y,l,p,_,b,g,w=new Phaser.Game(800,512,Phaser.AUTO,"",{preload:e,create:o,update:m}),f="No socket detected. The game must be played through a socket.io server to function properly.",x=5e3,h=5e3,E=[],R=[],B=window.parent.socket
B.emit("requestArrow"),"blue"===window.parent.__car__&&(l=!0)
var P=[{x:300,y:10,car:"bluecar",leftbounds:20,rightbounds:360,scorex:20,scorey:460},{x:600,y:10,car:"redcar",leftbounds:355,rightbounds:625,scorex:400,scorey:460}],v=l?P[0]:P[1],D=l?P[1]:P[0]
B||(document.getElementById("notify").innerText=f),window.parent.scrollTo(0,window.parent.document.body.scrollHeight),B.on("arrowResponse",function(e){u=!0}),B.on("enemyPos",function(e){p&&(p.x=e.x,p.y=e.y)}),B.on("enemyScore",function(e){h=e,g&&(g.text="Enemy Distance Remaining: "+e)}),B.on("enemyObj",function(e){if(_&&b&&document.hasFocus())if("stars"===e.type){var o=b.create(e.obj.x,e.obj.y,"star")
R.push(o)}else if("bombs"===e.type){var n=_.create(e.obj.x,e.obj.y,"bomb")
E.push(n)}}),B.on("winnerResponse",function(e){document.getElementById("notify").innerText="",e.winner!==window.parent.__userName__&&(h=0,B.emit("playerScore",{score:x,room:window.parent.__gameRoom__}))})})}multiMain()
