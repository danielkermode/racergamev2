function singleMain(){window.parent.__singlePlayer__&&(window.onload=function(){function e(){u.load.image("yellowcar","../resources/yellowcar.png"),u.load.image("road","../resources/road.png"),u.load.image("bomb","../resources/bomb.png"),u.load.image("star","../resources/star.png"),u.load.image("hud","../resources/hud.png"),u.load.image("diamond","../resources/diamond.png"),u.load.image("goodDiamond","../resources/goodDiamond.png")}function o(){u.physics.startSystem(Phaser.Physics.ARCADE),road=u.add.tileSprite(0,0,800,600,"road"),player=u.add.sprite(300,10,"yellowcar"),u.physics.arcade.enable(player),player.body.collideWorldBounds=!0,cursors=u.input.keyboard.createCursorKeys(),bombs=u.add.group(),bombs.enableBody=!0,stars=u.add.group(),stars.enableBody=!0,bombEmitter=u.add.emitter(0,0,100),bombEmitter.makeParticles("diamond"),starEmitter=u.add.emitter(0,0,100),starEmitter.makeParticles("goodDiamond"),u.add.tileSprite(0,450,800,100,"hud"),m=u.add.text(20,460,"Distance Remaining: "+y,{fontSize:"20px",fill:"#000"})
var e=r(600,800)
u.time.events.loop(e,i,this)}function r(e,o){return Math.floor(Math.random()*(o-e))+e}function t(e,o){o.destroy(),d(o,bombEmitter),y+=300}function a(e,o){o.destroy(),d(o,starEmitter),y>301?y-=300:y=1}function n(e,o){var r=e.getBounds(),t=o.getBounds()
return Phaser.Rectangle.intersects(r,t)}function i(){if(c&&!window.parent.__winner__){var e=Math.random()
if(e>.3){var o=bombs.create(r(30,360),400,"bomb")
g.push(o)}else{var t=stars.create(r(30,360),400,"star")
b.push(t)}}}function s(e,o){e.forEach(function(e,r,t){e.body?(e.body.y-=8,n(player,e)?o(player,e):e.body.y<-50&&(t.splice(r,1),e.destroy())):(t.splice(r,1),e.destroy())})}function d(e,o){o.x=e.x,o.y=e.y,o.start(!0,500,null,10)}function l(){y>0&&c?(s(g,t),s(b,a),y-=1,m.text="Distance Remaining: "+y,road.tilePosition.y-=8,cursors.left.isDown&&player.x>20?player.body.x-=20:cursors.right.isDown&&player.x<320&&(player.body.x+=20)):0>=y&&w.emit("requestWinner",{winner:window.parent.__userName__,room:window.parent.__gameRoom__})}var c,m,u=new Phaser.Game(800,512,Phaser.AUTO,"",{preload:e,create:o,update:l}),p="No socket detected. The game must be played through a socket.io server to function properly.",y=5e3,g=[],b=[],w=window.parent.socket
w.emit("requestArrow"),w||(document.getElementById("notify").innerText=p),window.parent.scrollTo(0,window.parent.document.body.scrollHeight),w.on("arrowResponse",function(e){c=!0})})}singleMain()
function multiMain(){window.parent.__multiPlayer__&&(window.onload=function(){function e(){x.stage.disableVisibilityChange=!0,x.load.image("redcar","../resources/redcar.png"),x.load.image("bluecar","../resources/bluecar.png"),x.load.image("road","../resources/road.png"),x.load.image("bomb","../resources/bomb.png"),x.load.image("star","../resources/star.png"),x.load.image("hud","../resources/hud.png"),x.load.image("diamond","../resources/diamond.png"),x.load.image("goodDiamond","../resources/goodDiamond.png")}function o(){x.physics.startSystem(Phaser.Physics.ARCADE),road=x.add.tileSprite(0,0,800,600,"road"),p=x.add.sprite(T.x,T.y,T.car),x.physics.arcade.enable(p),p.body.collideWorldBounds=!0,p.body.bounce.x=.95,b=x.add.sprite(j.x,j.y,j.car),x.physics.arcade.enable(b),b.body.collideWorldBounds=!0,b.body.bounce.x=.95,cursors=x.input.keyboard.createCursorKeys(),g=x.add.group(),g.enableBody=!0,w=x.add.group(),w.enableBody=!0,bombEmitter=x.add.emitter(0,0,100),bombEmitter.makeParticles("diamond"),starEmitter=x.add.emitter(0,0,100),starEmitter.makeParticles("goodDiamond"),x.add.tileSprite(0,450,800,100,"hud"),y=x.add.text(T.scorex,T.scorey,"Distance Remaining: "+v,{fontSize:"20px",fill:"#000"}),f=x.add.text(j.scorex,j.scorey,"Enemy Distance Remaining: "+R,{fontSize:"20px",fill:"#000"})
var e=n(600,800)
x.time.events.loop(e,a,this)}function n(e,o){return Math.floor(Math.random()*(o-e))+e}function t(e,o,n){o.destroy(),c(o,bombEmitter),n?(v+=300,D.emit("playerScore",{score:v,room:window.parent.__gameRoom__})):R+=300}function r(e,o,n){o.destroy(),c(o,starEmitter),n?(v>301?v-=300:v=1,D.emit("playerScore",{score:v,room:window.parent.__gameRoom__})):R>301?R-=300:R=1}function i(e,o){var n=e.getBounds(),t=o.getBounds()
return Phaser.Rectangle.intersects(n,t)}function a(){if(l&&!window.parent.__winner__&&document.hasFocus()){var e=Math.random()
if(e>.5){var o=g.create(n(T.leftbounds,T.rightbounds),400,"bomb")
B.push(o),d({x:o.x,y:o.y},"bombs")}else{var t=w.create(n(T.leftbounds,T.rightbounds),400,"star")
P.push(t),d({x:t.x,y:t.y},"stars")}}}function d(e,o){D.emit("playerObj",{obj:e,type:o,room:window.parent.__gameRoom__})}function s(e,o,n,t){e.forEach(function(e,r,a){e.body?(e.body.y-=E,i(n,e)?o(p,e,t):e.body.y<-50&&(a.splice(r,1),e.destroy())):(a.splice(r,1),e.destroy())})}function c(e,o){o.x=e.x,o.y=e.y,o.start(!0,500,null,10)}function m(e,o){D.emit("playerCollide",{x:o.body.velocity.x,room:window.parent.__gameRoom__})}function u(){x.physics.arcade.collide(p,b,m,null,this),document.hasFocus()||document.getElementById("notify").innerText||window.parent.__winner__?document.hasFocus()&&document.getElementById("notify").innerText&&(document.getElementById("notify").innerText=""):document.getElementById("notify").innerText="You lost focus. Click on the game to continue.",v>0&&l&&!window.parent.__winner__&&document.hasFocus()?(s(B,t,p,!0),s(B,t,b,!1),s(P,r,p,!0),s(P,r,b,!1),v-=1,y.text="Distance Remaining: "+v,D.emit("playerScore",{score:v,room:window.parent.__gameRoom__}),road.tilePosition.y-=E,cursors.left.isDown&&p.x>T.leftbounds?(p.body.velocity.x-=20,D.emit("playerPos",{x:p.body.velocity.x,room:window.parent.__gameRoom__})):cursors.right.isDown&&p.x<T.rightbounds&&(p.body.velocity.x+=20,D.emit("playerPos",{x:p.body.velocity.x,room:window.parent.__gameRoom__}))):0>=v&&!window.parent.__winner__&&D.emit("requestWinner",{winner:window.parent.__userName__,room:window.parent.__gameRoom__})}var l,y,_,p,b,g,w,f,x=new Phaser.Game(800,512,Phaser.AUTO,"",{preload:e,create:o,update:u}),h="No socket detected. The game must be played through a socket.io server to function properly.",v=5e3,R=5e3,E=6,B=[],P=[],D=window.parent.socket
D.emit("requestArrow"),"blue"===window.parent.__car__&&(_=!0)
var S=[{x:300,y:10,car:"bluecar",leftbounds:20,rightbounds:360,scorex:20,scorey:460},{x:600,y:10,car:"redcar",leftbounds:355,rightbounds:625,scorex:400,scorey:460}],T=_?S[0]:S[1],j=_?S[1]:S[0]
D||(document.getElementById("notify").innerText=h),window.parent.scrollTo(0,window.parent.document.body.scrollHeight),D.on("arrowResponse",function(e){l=!0}),D.on("enemyPos",function(e){b&&(b.body.velocity.x=e)}),D.on("enemyCollide",function(e){p&&(p.body.velocity.x=e)}),D.on("enemyScore",function(e){R=e,f&&(f.text="Enemy Distance Remaining: "+e)}),D.on("enemyObj",function(e){if(g&&w&&document.hasFocus())if("stars"===e.type){var o=w.create(e.obj.x,e.obj.y,"star")
P.push(o)}else if("bombs"===e.type){var n=g.create(e.obj.x,e.obj.y,"bomb")
B.push(n)}}),D.on("winnerResponse",function(e){document.getElementById("notify").innerText="",e.winner!==window.parent.__userName__&&(R=0,D.emit("playerScore",{score:v,room:window.parent.__gameRoom__}))})})}multiMain()
