function singleMain(){window.parent.__singlePlayer__&&(window.onload=function(){function e(){u.load.image("yellowcar","../resources/yellowcar.png"),u.load.image("road","../resources/road.png"),u.load.image("bomb","../resources/bomb.png"),u.load.image("star","../resources/star.png"),u.load.image("hud","../resources/hud.png"),u.load.image("diamond","../resources/diamond.png"),u.load.image("goodDiamond","../resources/goodDiamond.png")}function o(){u.physics.startSystem(Phaser.Physics.ARCADE),road=u.add.tileSprite(0,0,800,600,"road"),player=u.add.sprite(300,10,"yellowcar"),u.physics.arcade.enable(player),player.body.collideWorldBounds=!0,cursors=u.input.keyboard.createCursorKeys(),bombs=u.add.group(),bombs.enableBody=!0,stars=u.add.group(),stars.enableBody=!0,bombEmitter=u.add.emitter(0,0,100),bombEmitter.makeParticles("diamond"),starEmitter=u.add.emitter(0,0,100),starEmitter.makeParticles("goodDiamond"),u.add.tileSprite(0,450,800,100,"hud"),m=u.add.text(20,460,"Score: "+y,{fontSize:"32px",fill:"#000"})
var e=r(600,800)
u.time.events.loop(e,s,this)}function r(e,o){return Math.floor(Math.random()*(o-e))+e}function t(e,o){o.destroy(),d(o,bombEmitter),y+=300}function a(e,o){o.destroy(),d(o,starEmitter),y>301?y-=300:y=1}function n(e,o){var r=e.getBounds(),t=o.getBounds()
return Phaser.Rectangle.intersects(r,t)}function s(){if(c&&!window.parent.__winner__){var e=Math.random()
if(e>.3){var o=bombs.create(r(30,360),400,"bomb")
g.push(o)}else{var t=stars.create(r(30,360),400,"star")
b.push(t)}}}function i(e,o){e.forEach(function(e,r,t){e.body?(e.body.y-=8,n(player,e)?o(player,e):e.body.y<-50&&(t.splice(r,1),e.destroy())):(t.splice(r,1),e.destroy())})}function d(e,o){o.x=e.x,o.y=e.y,o.start(!0,500,null,10)}function l(){y>0&&c?(i(g,t),i(b,a),y-=1,m.text="Score: "+y,road.tilePosition.y-=8,cursors.left.isDown&&player.x>20?player.body.x-=20:cursors.right.isDown&&player.x<320&&(player.body.x+=20)):0>=y&&w.emit("requestWinner",{winner:window.parent.__userName__,room:window.parent.__gameRoom__})}var c,m,u=new Phaser.Game(800,512,Phaser.AUTO,"",{preload:e,create:o,update:l}),p="No socket detected. The game must be played through a socket.io server to function properly.",y=5e3,g=[],b=[],w=window.parent.socket
w.emit("requestArrow"),w||(document.getElementById("notify").innerText=p),window.parent.scrollTo(0,window.parent.document.body.scrollHeight),w.on("arrowResponse",function(e){c=!0})})}singleMain()
function multiMain(){window.parent.__multiPlayer__&&(window.onload=function(){function e(){g.stage.disableVisibilityChange=!0,g.load.image("redcar","../resources/redcar.png"),g.load.image("bluecar","../resources/bluecar.png"),g.load.image("road","../resources/road.png"),g.load.image("bomb","../resources/bomb.png"),g.load.image("star","../resources/star.png"),g.load.image("hud","../resources/hud.png"),g.load.image("diamond","../resources/diamond.png"),g.load.image("goodDiamond","../resources/goodDiamond.png")}function o(){g.physics.startSystem(Phaser.Physics.ARCADE),road=g.add.tileSprite(0,0,800,600,"road"),player=g.add.sprite(R.x,R.y,R.car),g.physics.arcade.enable(player),player.body.collideWorldBounds=!0,p=g.add.sprite(v.x,v.y,v.car),g.physics.arcade.enable(p),p.body.collideWorldBounds=!0,cursors=g.input.keyboard.createCursorKeys(),_=g.add.group(),_.enableBody=!0,b=g.add.group(),b.enableBody=!0,bombEmitter=g.add.emitter(0,0,100),bombEmitter.makeParticles("diamond"),starEmitter=g.add.emitter(0,0,100),starEmitter.makeParticles("goodDiamond"),g.add.tileSprite(0,450,800,100,"hud"),y=g.add.text(R.scorex,R.scorey,"Your Score: "+x,{fontSize:"32px",fill:"#000"}),w=g.add.text(v.scorex,v.scorey,"Enemy Score: "+h,{fontSize:"32px",fill:"#000"})
var e=r(600,800)
g.time.events.loop(e,i,this)}function r(e,o){return Math.floor(Math.random()*(o-e))+e}function n(e,o,r){o.destroy(),c(o,bombEmitter),r?(x+=300,B.emit("playerScore",{score:x,room:window.parent.__gameRoom__})):h+=300}function t(e,o,r){o.destroy(),c(o,starEmitter),r?(x>301?x-=300:x=1,B.emit("playerScore",{score:x,room:window.parent.__gameRoom__})):h>301?h-=300:h=1}function a(e,o){var r=e.getBounds(),n=o.getBounds()
return Phaser.Rectangle.intersects(r,n)}function i(){if(u&&!window.parent.__winner__&&document.hasFocus()){var e=Math.random()
if(e>.5){var o=_.create(r(R.leftbounds,R.rightbounds),400,"bomb")
E.push(o),s({x:o.x,y:o.y},"bombs")}else{var n=b.create(r(R.leftbounds,R.rightbounds),400,"star")
S.push(n),s({x:n.x,y:n.y},"stars")}}}function s(e,o){B.emit("playerObj",{obj:e,type:o,room:window.parent.__gameRoom__})}function d(e,o,r,n){e.forEach(function(e,t,i){e.body?(e.body.y-=8,a(r,e)?o(player,e,n):e.body.y<-50&&(i.splice(t,1),e.destroy())):(i.splice(t,1),e.destroy())})}function c(e,o){o.x=e.x,o.y=e.y,o.start(!0,500,null,10)}function m(){document.hasFocus()||document.getElementById("notify").innerText||window.parent.__winner__?document.hasFocus()&&document.getElementById("notify").innerText&&(document.getElementById("notify").innerText=""):document.getElementById("notify").innerText="You lost focus. Click on the game to continue.",x>0&&u&&!window.parent.__winner__&&document.hasFocus()?(d(E,n,player,!0),d(E,n,p,!1),d(S,t,player,!0),d(S,t,p,!1),x-=1,y.text="Your Score: "+x,B.emit("playerScore",{score:x,room:window.parent.__gameRoom__}),road.tilePosition.y-=8,cursors.left.isDown&&player.x>R.leftbounds?(player.body.x-=20,B.emit("playerPos",{pos:{x:player.x,y:player.y},room:window.parent.__gameRoom__})):cursors.right.isDown&&player.x<R.rightbounds&&(player.body.x+=20,B.emit("playerPos",{pos:{x:player.x,y:player.y},room:window.parent.__gameRoom__}))):0>=x&&!window.parent.__winner__&&B.emit("requestWinner",{winner:window.parent.__userName__,room:window.parent.__gameRoom__})}var u,y,l,p,_,b,w,g=new Phaser.Game(800,512,Phaser.AUTO,"",{preload:e,create:o,update:m}),f="No socket detected. The game must be played through a socket.io server to function properly.",x=5e3,h=5e3,E=[],S=[],B=window.parent.socket
B.emit("requestArrow"),"blue"===window.parent.__car__&&(l=!0)
var P=[{x:300,y:10,car:"bluecar",leftbounds:20,rightbounds:360,scorex:20,scorey:460},{x:600,y:10,car:"redcar",leftbounds:355,rightbounds:625,scorex:400,scorey:460}],R=l?P[0]:P[1],v=l?P[1]:P[0]
B||(document.getElementById("notify").innerText=f),window.parent.scrollTo(0,window.parent.document.body.scrollHeight),B.on("arrowResponse",function(e){u=!0}),B.on("enemyPos",function(e){p&&(p.x=e.x,p.y=e.y)}),B.on("enemyScore",function(e){h=e,w&&(w.text="Enemy Score: "+e)}),B.on("enemyObj",function(e){if(_&&b&&document.hasFocus())if("stars"===e.type){var o=b.create(e.obj.x,e.obj.y,"star")
S.push(o)}else if("bombs"===e.type){var r=_.create(e.obj.x,e.obj.y,"bomb")
E.push(r)}}),B.on("winnerResponse",function(e){document.getElementById("notify").innerText="",e.winner!==window.parent.__userName__&&(h=0,B.emit("playerScore",{score:x,room:window.parent.__gameRoom__}))})})}multiMain()
